This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
app/app.vue
app/assets/css/main.css
app/components/SdqForm.vue
app/components/SdqSelfForm.vue
app/components/SdqSelfFormRTL.vue
app/layouts/default.vue
app/pages/about.vue
app/pages/index.vue
app/utils/generateSdqPdf.ts
nuxt.config.ts
package.json
public/favicon.ico
public/fonts/NotoKufiArabic-Medium.ttf
public/forms/sdq_ar_self.pdf
public/robots.txt
README.md
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/app.vue">
<template>
  <div>
    <NuxtLayout>
      <NuxtPage />
    </NuxtLayout>
  </div>
</template>

<style></style>
</file>

<file path="app/assets/css/main.css">
@import 'tailwindcss';
@import '@nuxt/ui';
</file>

<file path="app/components/SdqForm.vue">
<script setup lang="ts">
import id from '@nuxt/ui/runtime/locale/id.js'
import { reactive, ref, computed } from 'vue'

/* ======================================================
   SDQ — Self Report (11–17 years)
   Scoring rules based on official SDQ documentation:
   - Reverse scored: 7, 11, 14, 21, 25
   - Subscales: Emotional, Conduct, Hyper, Peer, Prosocial
   References:
   • SDQ Self Scoring Guide (Youth) 11–17  :contentReference[oaicite:1]{index=1}
   • SDQ 4–17 Scoring Table  :contentReference[oaicite:2]{index=2}
   ====================================================== */

const questions = [
  {
    id: 1,
    text: 'I try to be nice to other people. I care about their feelings.'
  },
  { id: 2, text: 'I am restless; I cannot stay still for long.' },
  { id: 3, text: 'I get a lot of headaches, stomach-aches or sickness.' },
  { id: 4, text: 'I usually share with others, for example CDs, games, food.' },
  { id: 5, text: 'I get very angry and often lose my temper.' },
  { id: 6, text: 'I would rather be alone than with people of my age.' },
  { id: 7, text: 'I usually do as I am told.' },
  { id: 8, text: 'I worry a lot.' },
  { id: 9, text: 'I am helpful if someone is hurt, upset or feeling ill.' },
  { id: 10, text: 'I am constantly fidgeting or squirming.' },
  { id: 11, text: 'I have one good friend or more.' },
  { id: 12, text: 'I fight a lot. I can make other people do what I want.' },
  { id: 13, text: 'I am often unhappy, depressed or tearful.' },
  { id: 14, text: 'Other people my age generally like me.' },
  {
    id: 15,
    text: 'I am easily distracted; I find it difficult to concentrate.'
  },
  { id: 16, text: 'I am nervous in new situations. I easily lose confidence.' },
  { id: 17, text: 'I am kind to younger children.' },
  { id: 18, text: 'I am often accused of lying or cheating.' },
  { id: 19, text: 'Other children or young people pick on me or bully me.' },
  {
    id: 20,
    text: 'I often volunteer to help others (parents, teachers, children).'
  },
  { id: 21, text: 'I think before I do things.' },
  {
    id: 22,
    text: 'I take things that are not mine from home, school or elsewhere.'
  },
  {
    id: 23,
    text: 'I get along better with adults than with people my own age.'
  },
  { id: 24, text: 'I have many fears; I am easily scared.' },
  { id: 25, text: "I finish the work I'm doing. My attention is good." }
]

const options = [
  { label: 'Not true', value: 0 },
  { label: 'Somewhat true', value: 1 },
  { label: 'Certainly true', value: 2 }
]

const responses = reactive(
  Object.fromEntries(questions.map((q) => [q.id, null]))
)

const reverse = new Set([7, 11, 14, 21, 25])

const scoreItem = (id: number) => {
  if (id) {
    const v = responses[id]
    if (v === null) return NaN
    if (!reverse.has(id)) return v
    return v === 0 ? 2 : v === 2 ? 0 : 1
  }
}

// Subscale item groups
const emotional = [3, 8, 13, 16, 24]
const conduct = [5, 7, 12, 18, 22]
const hyper = [2, 10, 15, 21, 25]
const peer = [6, 11, 14, 19, 23]
const prosocial = [1, 4, 9, 17, 20]

// @ts-ignore
const sum = (arr: number[]) => arr.reduce((a, id) => a + scoreItem(id), 0)
// @ts-ignore

// Computed scores
const emotionalScore = computed(() => sum(emotional))
const conductScore = computed(() => sum(conduct))
const hyperScore = computed(() => sum(hyper))
const peerScore = computed(() => sum(peer))
const prosocialScore = computed(() => sum(prosocial))

const totalScore = computed(
  () =>
    emotionalScore.value +
    conductScore.value +
    hyperScore.value +
    peerScore.value
)

// Banding (Youth Self-Report) — SDQ Self categories  :contentReference[oaicite:3]{index=3}
const classify = (subscale: string, score: number) => {
  switch (subscale) {
    case 'total':
      if (score <= 14) return 'close'
      if (score <= 17) return 'slightly'
      if (score <= 19) return 'high'
      return 'very'
    case 'emotional':
      if (score <= 4) return 'close'
      if (score === 5) return 'slightly'
      if (score === 6) return 'high'
      return 'very'
    case 'conduct':
      if (score <= 3) return 'close'
      if (score === 4) return 'slightly'
      if (score === 5) return 'high'
      return 'very'
    case 'hyper':
      if (score <= 5) return 'close'
      if (score === 6) return 'slightly'
      if (score === 7) return 'high'
      return 'very'
    case 'peer':
      if (score <= 2) return 'close'
      if (score === 3) return 'slightly'
      if (score === 4) return 'high'
      return 'very'
    case 'prosocial':
      if (score >= 7) return 'close'
      if (score === 6) return 'slightly'
      if (score === 5) return 'high'
      return 'very'
    default:
      return 'close'
  }
}

const showResults = ref(false)

const allDone = computed(() => questions.every((q) => responses[q.id] !== null))

function submit() {
  if (!allDone.value) return alert('Please answer all questions.')
  showResults.value = true
}

const colorMap = {
  close: 'green',
  slightly: 'yellow',
  high: 'orange',
  very: 'red'
}
</script>

<template>
  <div class="space-y-6">
    <UCard>
      <template #header>
        <h1 class="text-xl font-bold">SDQ – Self Report (11–17 years)</h1>
        <p class="text-gray-500">
          How things have been for you over the last 6 months.
        </p>
      </template>

      <div class="space-y-4">
        <div
          v-for="q in questions"
          :key="q.id"
          class="p-4 border rounded-lg bg-gray-50"
        >
          <div class="font-medium mb-2">{{ q.id }}. {{ q.text }}</div>
          <URadioGroup v-model="responses[q.id]" :items="options" />

          <!-- <URadio
            v-for="opt in options"
            :key="opt.value"
            v-model="responses[q.id]"
            :value="opt.value"
            :label="opt.label"
            class="block py-1"
          /> -->
        </div>

        <UButton color="primary" block @click="submit"> Show Results </UButton>
      </div>
    </UCard>

    <!-- RESULTS -->
    <UCard v-if="showResults" class="mt-6">
      <template #header>
        <h2 class="text-lg font-bold">Your SDQ Results</h2>
      </template>

      <div class="space-y-6">
        <!-- Total -->
        <div>
          <div class="text-md font-semibold">
            Total Difficulties: {{ totalScore }} / 40
          </div>
          <UProgress
            :model-value="totalScore"
            :max="40"
            color="primary"
            class="h-2"
          />
          <p class="text-sm mt-1 text-gray-600 capitalize">
            {{ classify('total', totalScore) }} difficulties
          </p>
        </div>

        <!-- Subscales -->
        <div
          v-for="block in [
            {
              label: 'Emotional Symptoms',
              score: emotionalScore,
              id: 'emotional'
            },
            { label: 'Conduct Problems', score: conductScore, id: 'conduct' },
            { label: 'Hyperactivity', score: hyperScore, id: 'hyper' },
            { label: 'Peer Problems', score: peerScore, id: 'peer' },
            {
              label: 'Prosocial Behaviour',
              score: prosocialScore,
              id: 'prosocial'
            }
          ]"
          :key="block.id"
        >
          <div class="font-medium">
            {{ block.label }}: {{ block.score }} / 10
          </div>

          <UProgress
            :model-value="block.score"
            :max="10"
            color="primary"
            class="h-2"
          />

          <p class="text-sm text-gray-600 capitalize">
            {{ classify(block.id, block.score) }}
          </p>
        </div>
      </div>
    </UCard>
  </div>
</template>
</file>

<file path="app/components/SdqSelfForm.vue">
<template>
  <div class="sdq-app">
    <header class="sdq-header">
      <h1>Strengths and Difficulties Questionnaire (Self)</h1>
      <p class="subtitle">
        Please answer how things have been for you over the last six months.
      </p>
    </header>

    <!-- Form -->
    <form class="sdq-form" @submit.prevent="onSubmit">
      <div v-for="q in questions" :key="q.id" class="question-card">
        <div class="question-number">Question {{ q.id }}</div>
        <div class="question-text">{{ q.text }}</div>

        <div class="options">
          <label v-for="opt in answerOptions" :key="opt.value" class="option">
            <input
              type="radio"
              :name="'q-' + q.id"
              :value="opt.value"
              v-model.number="responses[q.id]"
              :disabled="showResults"
            />
            <span>{{ opt.label }}</span>
          </label>
        </div>
      </div>

      <div class="actions">
        <button type="submit" class="primary-btn">
          {{ showResults ? 'Recalculate' : 'See my results' }}
        </button>
        <p v-if="validationError" class="error">
          {{ validationError }}
        </p>
      </div>
    </form>

    <!-- Results -->
    <section v-if="showResults" class="results">
      <h2>Your scores</h2>

      <div class="scores-grid">
        <div
          class="score-card"
          :class="getBandClass('total', totalDifficulties)"
        >
          <h3>Total Difficulties</h3>
          <p class="score-value">{{ totalDifficulties }} / 40</p>
          <p class="score-band">
            {{ getBandLabel('total', totalDifficulties) }}
          </p>
        </div>

        <div
          class="score-card"
          :class="getBandClass('emotional', emotionalScore)"
        >
          <h3>Emotional Symptoms</h3>
          <p class="score-value">{{ emotionalScore }} / 10</p>
          <p class="score-band">
            {{ getBandLabel('emotional', emotionalScore) }}
          </p>
        </div>

        <div class="score-card" :class="getBandClass('conduct', conductScore)">
          <h3>Conduct Problems</h3>
          <p class="score-value">{{ conductScore }} / 10</p>
          <p class="score-band">{{ getBandLabel('conduct', conductScore) }}</p>
        </div>

        <div
          class="score-card"
          :class="getBandClass('hyperactivity', hyperScore)"
        >
          <h3>Hyperactivity</h3>
          <p class="score-value">{{ hyperScore }} / 10</p>
          <p class="score-band">
            {{ getBandLabel('hyperactivity', hyperScore) }}
          </p>
        </div>

        <div class="score-card" :class="getBandClass('peer', peerScore)">
          <h3>Peer Problems</h3>
          <p class="score-value">{{ peerScore }} / 10</p>
          <p class="score-band">{{ getBandLabel('peer', peerScore) }}</p>
        </div>

        <div
          class="score-card"
          :class="getBandClass('prosocial', prosocialScore)"
        >
          <h3>Prosocial Behaviour</h3>
          <p class="score-value">{{ prosocialScore }} / 10</p>
          <p class="score-band">
            {{ getBandLabel('prosocial', prosocialScore) }}
          </p>
        </div>
      </div>

      <p class="disclaimer">
        These scores are for screening only and do not give a diagnosis. If you
        are worried by these results, please talk to a trusted adult or
        professional.
      </p>
    </section>
  </div>
</template>

<script setup lang="ts">
import { reactive, computed, ref } from 'vue'

type ScaleKey =
  | 'total'
  | 'emotional'
  | 'conduct'
  | 'hyperactivity'
  | 'peer'
  | 'prosocial'

type AnswerValue = 0 | 1 | 2

interface Question {
  id: number
  text: string
}

// --- Questions: SDQ Self-report 11–17, items 1–25 ---
const questions: Question[] = [
  {
    id: 1,
    text: 'I try to be nice to other people. I care about their feelings.'
  },
  { id: 2, text: 'I am restless; I cannot stay still for long.' },
  { id: 3, text: 'I get a lot of headaches, stomach-aches or sickness.' },
  { id: 4, text: 'I usually share with others, for example CDs, games, food.' },
  { id: 5, text: 'I get very angry and often lose my temper.' },
  { id: 6, text: 'I would rather be alone than with people my age.' },
  { id: 7, text: 'I usually do as I am told.' },
  { id: 8, text: 'I worry a lot.' },
  { id: 9, text: 'I am helpful if someone is hurt, upset or feeling ill.' },
  { id: 10, text: 'I am constantly fidgeting or squirming.' },
  { id: 11, text: 'I have one good friend or more.' },
  { id: 12, text: 'I fight a lot. I can make other people do what I want.' },
  { id: 13, text: 'I am often unhappy, depressed or tearful.' },
  { id: 14, text: 'Other people my age generally like me.' },
  {
    id: 15,
    text: 'I am easily distracted; I find it difficult to concentrate.'
  },
  { id: 16, text: 'I am nervous in new situations. I easily lose confidence.' },
  { id: 17, text: 'I am kind to younger children.' },
  { id: 18, text: 'I am often accused of lying or cheating.' },
  { id: 19, text: 'Other children or young people pick on me or bully me.' },
  {
    id: 20,
    text: 'I often volunteer to help others (parents, teachers, children).'
  },
  { id: 21, text: 'I think before I do things.' },
  {
    id: 22,
    text: 'I take things that are not mine from home, school or elsewhere.'
  },
  {
    id: 23,
    text: 'I get along better with adults than with people my own age.'
  },
  { id: 24, text: 'I have many fears; I am easily scared.' },
  { id: 25, text: 'I finish the work I’m doing. My attention is good.' }
]

// Response options (data entry values 0,1,2)
const answerOptions = [
  { label: 'Not true', value: 0 },
  { label: 'Somewhat true', value: 1 },
  { label: 'Certainly true', value: 2 }
]

// Responses keyed by item id
const responses = reactive<Record<number, AnswerValue | null>>(
  Object.fromEntries(questions.map((q) => [q.id, null]))
)

const showResults = ref(false)
const validationError = ref('')

// Reverse-scored items (0→2, 1→1, 2→0)
const reverseScoredItems = new Set([7, 11, 14, 21, 25])

// Helper: get item score with reverse scoring applied
function getItemScore(id: number): number {
  const raw = responses[id]
  if (raw === null || raw === undefined) return NaN
  if (!reverseScoredItems.has(id)) return raw
  if (raw === 0) return 2
  if (raw === 2) return 0
  return 1
}

// --- Subscale composition (item ids) ---
const emotionalItems = [3, 8, 13, 16, 24]
const conductItems = [5, 7, 12, 18, 22]
const hyperItems = [2, 10, 15, 21, 25]
const peerItems = [6, 11, 14, 19, 23]
const prosocialItems = [1, 4, 9, 17, 20]

// Helper to sum a list of items (ignores missing)
function sumItems(ids: number[]): number {
  return ids.reduce((acc, id) => {
    const val = getItemScore(id)
    if (!Number.isNaN(val)) return acc + val
    return acc
  }, 0)
}

// Computed subscale scores (0–10 each)
const emotionalScore = computed(() => sumItems(emotionalItems))
const conductScore = computed(() => sumItems(conductItems))
const hyperScore = computed(() => sumItems(hyperItems))
const peerScore = computed(() => sumItems(peerItems))
const prosocialScore = computed(() => sumItems(prosocialItems))

// Total difficulties = emotional + conduct + hyper + peer (0–40)
const totalDifficulties = computed(
  () =>
    emotionalScore.value +
    conductScore.value +
    hyperScore.value +
    peerScore.value
)

// --- Banding according to SDQ self-report cut-points (4-band) ---
// From official scoring guide for 4–17 self-report. :contentReference[oaicite:2]{index=2}
function getBandLabel(scale: ScaleKey, score: number): string {
  switch (scale) {
    case 'total':
      if (score <= 14) return 'Close to average'
      if (score <= 17) return 'Slightly raised'
      if (score <= 19) return 'High'
      return 'Very high'
    case 'emotional':
      if (score <= 4) return 'Close to average'
      if (score === 5) return 'Slightly raised'
      if (score === 6) return 'High'
      return 'Very high' // 7–10
    case 'conduct':
      if (score <= 3) return 'Close to average'
      if (score === 4) return 'Slightly raised'
      if (score === 5) return 'High'
      return 'Very high' // 6–10
    case 'hyperactivity':
      if (score <= 5) return 'Close to average'
      if (score === 6) return 'Slightly raised'
      if (score === 7) return 'High'
      return 'Very high' // 8–10
    case 'peer':
      if (score <= 2) return 'Close to average'
      if (score === 3) return 'Slightly raised'
      if (score === 4) return 'High'
      return 'Very high' // 5–10
    case 'prosocial':
      // Prosocial is reversed: lower scores mean more concern
      if (score >= 7) return 'Close to average'
      if (score === 6) return 'Slightly lowered'
      if (score === 5) return 'Low'
      return 'Very low' // 0–4
  }
}

// Map band to a color class (green → yellow → orange → red)
function getBandClass(scale: ScaleKey, score: number): string {
  const label = getBandLabel(scale, score)
  if (label === 'Close to average') return 'band-ok'
  if (label === 'Slightly raised' || label === 'Slightly lowered')
    return 'band-mild'
  if (label === 'High' || label === 'Low') return 'band-high'
  return 'band-very-high' // Very high / Very low
}

// Validate all questions answered
function allAnswered(): boolean {
  return questions.every(
    (q) => responses[q.id] !== null && responses[q.id] !== undefined
  )
}

// Submit handler
function onSubmit() {
  if (!allAnswered()) {
    validationError.value =
      'Please answer all questions before seeing your results.'
    showResults.value = false
    return
  }
  validationError.value = ''
  showResults.value = true
}
</script>

<style scoped>
.sdq-app {
  max-width: 900px;
  margin: 0 auto;
  padding: 1.5rem;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
    sans-serif;
  color: #111827;
}

.sdq-header {
  text-align: center;
  margin-bottom: 1rem;
}

.sdq-header h1 {
  font-size: 1.6rem;
  margin-bottom: 0.25rem;
}

.subtitle {
  font-size: 0.95rem;
  color: #4b5563;
}

.sdq-form {
  margin-top: 1rem;
}

.question-card {
  border-radius: 0.75rem;
  border: 1px solid #e5e7eb;
  padding: 1rem;
  margin-bottom: 0.75rem;
  background: #f9fafb;
}

.question-number {
  font-size: 0.75rem;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.35rem;
}

.question-text {
  font-size: 0.95rem;
  margin-bottom: 0.7rem;
}

.options {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
}

.option {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  font-size: 0.9rem;
  padding: 0.25rem 0.6rem;
  border-radius: 999px;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  cursor: pointer;
}

.option input {
  cursor: pointer;
}

.actions {
  margin-top: 1.25rem;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.4rem;
}

.primary-btn {
  border: none;
  border-radius: 999px;
  padding: 0.6rem 1.5rem;
  font-size: 0.95rem;
  font-weight: 600;
  background: linear-gradient(to right, #16a34a, #22c55e);
  color: white;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(34, 197, 94, 0.3);
}

.primary-btn:hover {
  opacity: 0.95;
}

.error {
  color: #b91c1c;
  font-size: 0.85rem;
}

/* Results */
.results {
  margin-top: 2rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.results h2 {
  font-size: 1.3rem;
  margin-bottom: 0.75rem;
}

.scores-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 0.9rem;
}

.score-card {
  border-radius: 0.9rem;
  padding: 0.9rem;
  color: #111827;
  background: #f9fafb;
  border: 1px solid #e5e7eb;
}

.score-card h3 {
  font-size: 0.95rem;
  margin-bottom: 0.25rem;
}

.score-value {
  font-size: 1.4rem;
  font-weight: 700;
  margin-bottom: 0.1rem;
}

.score-band {
  font-size: 0.85rem;
}

/* Band color classes */
.band-ok {
  background: #ecfdf3;
  border-color: #bbf7d0;
}

.band-mild {
  background: #fefce8;
  border-color: #facc15;
}

.band-high {
  background: #fef3c7;
  border-color: #f97316;
}

.band-very-high {
  background: #fef2f2;
  border-color: #ef4444;
}

.disclaimer {
  margin-top: 1rem;
  font-size: 0.85rem;
  color: #4b5563;
}

@media (max-width: 640px) {
  .sdq-app {
    padding: 1rem;
  }
}
</style>
</file>

<file path="app/components/SdqSelfFormRTL.vue">
<template>
  <UContainer class="sdq-app">
    <div class="text-center">
      <div
        class="text-[24px] font-bold linear-g rounded-lg text-white mb-4 p-2"
      >
        <p>SDQ</p>

        <p>استبيان نقاط القوة والصعوبات (نسخة ذاتية)</p>
      </div>

      <p class="dark:text-neutral-400 text-sm">
        من فضلك أجب عن كيفية كون الأمور معك خلال الأشهر الستة الماضية.
      </p>
    </div>

    <div dir="ltr" class="text-left">
      <UColorModeSwitch />
    </div>
    <!-- Form -->

    <form class="sdq-form" @submit.prevent="onSubmit">
      <UCard v-for="q in questions" :key="q.id" class="mb-4 shadow">
        <template #default>
          <div>
            <p>{{ q.id }} - {{ q.text }}</p>
          </div>
        </template>
        <template #footer>
          <div class="options">
            <URadioGroup
              v-model="responses[q.id]"
              :items="answerOptions"
              variant="table"
              indicator="end"
              class="w-full"
              size="md"
            />
          </div>
        </template>
      </UCard>

      <div class="actions">
        <button
          type="submit"
          class="primary-btn linear-g"
          @click.prevent="showResults ? resetForm() : onSubmit()"
        >
          {{ showResults ? 'إعادة الحساب' : 'عرض نتائجي' }}
        </button>
        <button
          @click="downloadPdf"
          v-if="showResults"
          class="primary-btn linear-g"
        >
          تنزيل النسخة الأصلية مع إجاباتك
        </button>
        <p v-if="validationError" class="error">
          {{ validationError }}
        </p>
      </div>
    </form>

    <!-- Results -->
    <section v-if="showResults" class="results">
      <h2>درجاتك</h2>

      <div class="score-card" :class="getBandClass('total', totalDifficulties)">
        <h3>مجموع الصعوبات</h3>
        <p class="score-value">{{ totalDifficulties }} / 40</p>
        <p class="score-band">
          {{ getBandLabel('total', totalDifficulties) }}
        </p>
      </div>

      <USeparator class="my-4" />
      <div class="scores-grid">
        <div
          class="score-card"
          :class="getBandClass('emotional', emotionalScore)"
        >
          <h3>الأعراض الانفعالية</h3>
          <p class="score-value">{{ emotionalScore }} / 10</p>
          <p class="score-band">
            {{ getBandLabel('emotional', emotionalScore) }}
          </p>
        </div>

        <div class="score-card" :class="getBandClass('conduct', conductScore)">
          <h3>مشكلات السلوك</h3>
          <p class="score-value">{{ conductScore }} / 10</p>
          <p class="score-band">
            {{ getBandLabel('conduct', conductScore) }}
          </p>
        </div>

        <div
          class="score-card"
          :class="getBandClass('hyperactivity', hyperScore)"
        >
          <h3>فرط الحركة وتشتت الانتباه</h3>
          <p class="score-value">{{ hyperScore }} / 10</p>
          <p class="score-band">
            {{ getBandLabel('hyperactivity', hyperScore) }}
          </p>
        </div>

        <div class="score-card" :class="getBandClass('peer', peerScore)">
          <h3>مشكلات الأقران</h3>
          <p class="score-value">{{ peerScore }} / 10</p>
          <p class="score-band">{{ getBandLabel('peer', peerScore) }}</p>
        </div>

        <div
          class="score-card"
          :class="getBandClass('prosocial', prosocialScore)"
        >
          <h3>السلوك الاجتماعي الإيجابي</h3>
          <p class="score-value">{{ prosocialScore }} / 10</p>
          <p class="score-band">
            {{ getBandLabel('prosocial', prosocialScore) }}
          </p>
        </div>
      </div>

      <p class="mt-8 text-neutral-500 text-xs text-justify">
        هذه الدرجات لغرض الفحص الأولي فقط ولا تُعطي تشخيصاً. إذا شعرت بالقلق من
        هذه النتائج، من الأفضل أن تتحدث مع شخص بالغ موثوق أو مع مختص نفسي.
      </p>
    </section>
  </UContainer>
</template>

<script setup lang="ts">
import { reactive, computed, ref } from 'vue'
import { generateSdqPdf } from '~/utils/generateSdqPdf'

const router = useRouter()

const resetForm = () => {
  router.go(0)
}

async function downloadPdf() {
  // Turn reactive responses into a plain object
  const plainResponses: Record<number, 0 | 1 | 2> = {}
  for (const [id, val] of Object.entries(responses)) {
    //
    plainResponses[Number(id)] = val as 0 | 1 | 2
  }

  const scores = {
    total: totalDifficulties.value,
    emotional: emotionalScore.value,
    conduct: conductScore.value,
    hyper: hyperScore.value,
    peer: peerScore.value,
    prosocial: prosocialScore.value
  }

  const bands = {
    total: getBandLabel('total', totalDifficulties.value),
    emotional: getBandLabel('emotional', emotionalScore.value),
    conduct: getBandLabel('conduct', conductScore.value),
    hyper: getBandLabel('hyperactivity', hyperScore.value),
    peer: getBandLabel('peer', peerScore.value),
    prosocial: getBandLabel('prosocial', prosocialScore.value)
  }

  const arabicLines = [
    `مجموع الصعوبات: ${scores.total} / 40 – ${bands.total}`,
    `الأعراض الانفعالية: ${scores.emotional} / 10 – ${bands.emotional}`,
    `مشكلات السلوك: ${scores.conduct} / 10 – ${bands.conduct}`,
    `فرط الحركة وتشتت الانتباه: ${scores.hyper} / 10 – ${bands.hyper}`,
    `مشكلات الأقران: ${scores.peer} / 10 – ${bands.peer}`,
    `السلوك الاجتماعي الإيجابي: ${scores.prosocial} / 10 – ${bands.prosocial}`
  ]

  function createArabicSummaryImage(lines: string[]): string {
    const canvas = document.createElement('canvas')
    canvas.width = 800
    canvas.height = lines.length * 30 + 40

    const ctx = canvas.getContext('2d')!
    ctx.fillStyle = '#000'
    ctx.font = '18px "Noto Sans Arabic", Arial'
    ctx.textAlign = 'right'
    ctx.direction = 'rtl'

    let y = 30
    for (const line of lines) {
      ctx.fillText(line, canvas.width - 20, y)
      y += 24
    }

    // returns a dataURL we can feed to pdf-lib
    return canvas.toDataURL('image/png')
  }

  const summaryDataUrl = createArabicSummaryImage(arabicLines)

  const pdfBytes = await generateSdqPdf({
    responses: plainResponses,
    scores,
    bands,
    summaryPngDataUrl: summaryDataUrl
  })

  // @ts-ignore
  const blob = new Blob([pdfBytes], { type: 'application/pdf' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = 'SDQ_self_report_with_results.pdf'
  a.click()
  URL.revokeObjectURL(url)
}

type ScaleKey =
  | 'total'
  | 'emotional'
  | 'conduct'
  | 'hyperactivity'
  | 'peer'
  | 'prosocial'

type AnswerValue = 0 | 1 | 2 | undefined

interface Question {
  id: number
  text: string
}

// --- Questions: SDQ Self-report 11–17, items 1–25 (Arabic text) ---
const questions: Question[] = [
  {
    id: 1,
    text: 'أحاول أن أكون لطيفاً مع الآخرين وأهتم بمشاعرهم.'
  },
  { id: 2, text: 'أنا كثير الحركة ولا أستطيع البقاء جالساً لفترة طويلة.' },
  {
    id: 3,
    text: 'أُصاب كثيراً بالصداع أو ألم المعدة أو أشعر بالتوعك.'
  },
  {
    id: 4,
    text: 'عادةً ما أشارك الآخرين في أشيائي، مثل الأقراص والألعاب والطعام.'
  },
  { id: 5, text: 'أغضب جداً وأفقد أعصابي كثيراً.' },
  { id: 6, text: 'أفضل أن أبقى وحدي على أن أكون مع من هم في مثل عمري.' },
  { id: 7, text: 'عادةً ما أنفذ ما يُطلب مني.' },
  { id: 8, text: 'أفكر وأقلق كثيراً بشأن أشياء مختلفة.' },
  {
    id: 9,
    text: 'أكون متعاوناً عندما يكون شخص ما متألماً أو منزعجاً أو مريضاً.'
  },
  { id: 10, text: 'أتحرك باستمرار وأعبث كثيراً في مكاني.' },
  { id: 11, text: 'لدي صديق جيد واحد على الأقل، وربما أكثر.' },
  {
    id: 12,
    text: 'أدخل في شجار كثيراً، ويمكنني أن أجبر الآخرين على فعل ما أريد.'
  },
  {
    id: 13,
    text: 'غالباً ما أشعر بالحزن أو الاكتئاب أو أبكي كثيراً.'
  },
  { id: 14, text: 'أقراني في نفس عمري غالباً ما يحبونني.' },
  {
    id: 15,
    text: 'أتشتت بسهولة؛ أجد صعوبة في التركيز والانتباه.'
  },
  {
    id: 16,
    text: 'أتوتر في المواقف الجديدة وأفقد ثقتي بنفسي بسهولة.'
  },
  { id: 17, text: 'أعامل الأطفال الأصغر مني بلطف.' },
  { id: 18, text: 'غالباً ما يتهمني الآخرون بالكذب أو الغش.' },
  {
    id: 19,
    text: 'يتعرض لي الأطفال أو اليافعون الآخرون، يضايقونني أو يتنمّرون عليّ.'
  },
  {
    id: 20,
    text: 'غالباً ما أُبادر لمساعدة الآخرين (أهلي، معلميَّ، الأطفال).'
  },
  { id: 21, text: 'أفكر جيداً قبل أن أتصرف.' },
  {
    id: 22,
    text: 'آخذ أشياء ليست لي من البيت أو المدرسة أو من أماكن أخرى.'
  },
  {
    id: 23,
    text: 'أتفاهم مع البالغين أفضل من تفاهمي مع من هم في مثل عمري.'
  },
  { id: 24, text: 'لدي مخاوف كثيرة، وأخاف بسهولة.' },
  {
    id: 25,
    text: 'أنهي الأعمال التي أبدأ بها؛ يكون انتباهي جيداً أغلب الوقت.'
  }
]

// Response options (data entry values 0,1,2)
const answerOptions = [
  { label: 'غير صحيح', value: 0 },
  { label: 'صحيح إلى حد ما', value: 1 },
  { label: 'صحيح تماماً', value: 2 }
]

// Responses keyed by item id
const responses = reactive<Record<number, AnswerValue | undefined>>(
  Object.fromEntries(questions.map((q) => [q.id, undefined])) as Record<
    number,
    AnswerValue | undefined
  >
)

const showResults = ref(false)
const validationError = ref('')

// Reverse-scored items (0→2, 1→1, 2→0)
const reverseScoredItems = new Set([7, 11, 14, 21, 25])

// Helper: get item score with reverse scoring applied
function getItemScore(id: number): number {
  const raw = responses[id]
  if (raw === null || raw === undefined) return NaN
  if (!reverseScoredItems.has(id)) return raw
  if (raw === 0) return 2
  if (raw === 2) return 0
  return 1
}

// --- Subscale composition (item ids) ---
const emotionalItems = [3, 8, 13, 16, 24]
const conductItems = [5, 7, 12, 18, 22]
const hyperItems = [2, 10, 15, 21, 25]
const peerItems = [6, 11, 14, 19, 23]
const prosocialItems = [1, 4, 9, 17, 20]

// Helper to sum a list of items (ignores missing)
function sumItems(ids: number[]): number {
  return ids.reduce((acc, id) => {
    const val = getItemScore(id)
    if (!Number.isNaN(val)) return acc + val
    return acc
  }, 0)
}

// Computed subscale scores (0–10 each)
const emotionalScore = computed(() => sumItems(emotionalItems))
const conductScore = computed(() => sumItems(conductItems))
const hyperScore = computed(() => sumItems(hyperItems))
const peerScore = computed(() => sumItems(peerItems))
const prosocialScore = computed(() => sumItems(prosocialItems))

// Total difficulties = emotional + conduct + hyper + peer (0–40)
const totalDifficulties = computed(
  () =>
    emotionalScore.value +
    conductScore.value +
    hyperScore.value +
    peerScore.value
)

// --- Banding (Arabic labels) ---
function getBandLabel(scale: ScaleKey, score: number): string {
  switch (scale) {
    case 'total':
      if (score <= 14) return 'ضمن المعدل'
      if (score <= 17) return 'أعلى من المعدل قليلاً'
      if (score <= 19) return 'مرتفع'
      return 'مرتفع جداً'
    case 'emotional':
      if (score <= 4) return 'ضمن المعدل'
      if (score === 5) return 'أعلى من المعدل قليلاً'
      if (score === 6) return 'مرتفع'
      return 'مرتفع جداً' // 7–10
    case 'conduct':
      if (score <= 3) return 'ضمن المعدل'
      if (score === 4) return 'أعلى من المعدل قليلاً'
      if (score === 5) return 'مرتفع'
      return 'مرتفع جداً' // 6–10
    case 'hyperactivity':
      if (score <= 5) return 'ضمن المعدل'
      if (score === 6) return 'أعلى من المعدل قليلاً'
      if (score === 7) return 'مرتفع'
      return 'مرتفع جداً' // 8–10
    case 'peer':
      if (score <= 2) return 'ضمن المعدل'
      if (score === 3) return 'أعلى من المعدل قليلاً'
      if (score === 4) return 'مرتفع'
      return 'مرتفع جداً' // 5–10
    case 'prosocial':
      // Prosocial reversed: lower scores mean more concern
      if (score >= 7) return 'ضمن المعدل'
      if (score === 6) return 'أقل من المعدل قليلاً'
      if (score === 5) return 'منخفض'
      return 'منخفض جداً' // 0–4
  }
}

// Map band to a color class (green → yellow → orange → red)
function getBandClass(scale: ScaleKey, score: number): string {
  const label = getBandLabel(scale, score)
  if (label === 'ضمن المعدل') return 'band-ok'
  if (label === 'أعلى من المعدل قليلاً' || label === 'أقل من المعدل قليلاً')
    return 'band-mild'
  if (label === 'مرتفع' || label === 'منخفض') return 'band-high'
  return 'band-very-high' // مرتفع جداً / منخفض جداً
}

// Validate all questions answered
function allAnswered(): boolean {
  return questions.every(
    (q) => responses[q.id] !== null && responses[q.id] !== undefined
  )
}

// Submit handler
function onSubmit() {
  if (!allAnswered()) {
    validationError.value = 'من فضلك أجب عن جميع الأسئلة قبل عرض النتائج.'
    showResults.value = false
    return
  }
  validationError.value = ''
  showResults.value = true
}
</script>

<style scoped>
.sdq-app {
  font-family: 'Noto Kufi Arabic', 'Scheherazade New', 'Amiri',
    'Noto Sans Arabic', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
    sans-serif;
  direction: rtl;
  text-align: right;
}

.sdq-form {
  margin-top: 1rem;
}

.question-number {
  font-size: 0.75rem;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.35rem;
}

.actions {
  margin-top: 1.25rem;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.4rem;
}

.primary-btn {
  border: none;
  width: 100%;
  margin-top: 1rem;
  border-radius: 999px;
  padding: 0.6rem 1.5rem;
  font-size: 0.95rem;
  font-weight: 600;
  color: white;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(34, 197, 94, 0.3);
}

.linear-g {
  background: linear-gradient(to left, #16a34a, #22c55e);
}

.primary-btn:hover {
  opacity: 0.95;
}

.error {
  color: #b91c1c;
  font-size: 0.85rem;
}

/* Results */
.results {
  margin-top: 2rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.results h2 {
  font-size: 1.3rem;
  margin-bottom: 0.75rem;
}

.scores-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 0.9rem;
}

.score-card {
  border-radius: 0.9rem;
  padding: 0.9rem;
  color: #111827;
  background: #f9fafb;
  border: 1px solid #e5e7eb;
}

.score-card h3 {
  font-size: 0.95rem;
  margin-bottom: 0.25rem;
}

.score-value {
  font-size: 1.4rem;
  font-weight: 700;
  margin-bottom: 0.1rem;
}

.score-band {
  font-size: 0.85rem;
}

/* Band color classes */
.band-ok {
  background: #e8feeb;
  border-color: #15fa5d;
}

.band-mild {
  background: #fefce8;
  border-color: #facc15;
}

.band-high {
  background: #fef3c7;
  border-color: #f97316;
}

.band-very-high {
  background: #fef2f2;
  border-color: #ef4444;
}
</style>
</file>

<file path="app/layouts/default.vue">
<template>
  <slot />
</template>
</file>

<file path="app/pages/about.vue">
<template>
  <div>
    <p>About</p>
  </div>
</template>
</file>

<file path="app/pages/index.vue">
<template>
  <div class="bg-gray-50 dark:bg-gray-800 py-[50px]">
    <SdqSelfFormRTL />
  </div>
</template>

<script setup lang="ts">
// empty for now
</script>
</file>

<file path="app/utils/generateSdqPdf.ts">
import { PDFDocument, StandardFonts } from 'pdf-lib'
import fontkit from '@pdf-lib/fontkit'

export interface SdqScores {
  total: number
  emotional: number
  conduct: number
  hyper: number
  peer: number
  prosocial: number
}

export interface SdqBands {
  total: string
  emotional: string
  conduct: string
  hyper: string
  peer: string
  prosocial: string
}

export interface GenerateSdqPdfInput {
  responses: Record<number, 0 | 1 | 2>
  scores: SdqScores
  bands: SdqBands
  summaryPngDataUrl: string
}

export async function generateSdqPdf({
  responses,
  summaryPngDataUrl
}: GenerateSdqPdfInput) {
  // Load template PDF
  const existingPdfBytes = await fetch('/forms/sdq_ar_self.pdf').then((r) =>
    r.arrayBuffer()
  )
  const pdfDoc = await PDFDocument.load(existingPdfBytes)

  pdfDoc.registerFontkit(fontkit)

  const fontBytes = await fetch('/fonts/NotoKufiArabic-Medium.ttf').then((r) =>
    r.arrayBuffer()
  )
  const arabicFont = await pdfDoc.embedFont(fontBytes)

  const page = pdfDoc.getPage(0)

  //   const font = await pdfDoc.embedFont(StandardFonts.TimesRoman)

  // Checkbox coordinates for each item (example)
  // You will fill these based on your PDF
  const checkboxCoords = {
    1: { notTrue: [151, 635], somewhat: [99, 635], certainly: [48, 635] },
    2: { notTrue: [151, 615], somewhat: [99, 615], certainly: [48, 615] },
    3: { notTrue: [151, 595], somewhat: [99, 595], certainly: [48, 595] },
    4: { notTrue: [151, 575], somewhat: [99, 575], certainly: [48, 575] },
    5: { notTrue: [151, 555], somewhat: [99, 555], certainly: [48, 555] },
    6: { notTrue: [151, 535], somewhat: [99, 535], certainly: [48, 535] },
    7: { notTrue: [151, 515], somewhat: [99, 515], certainly: [48, 515] },
    8: { notTrue: [151, 495], somewhat: [99, 495], certainly: [48, 495] },
    9: { notTrue: [151, 475], somewhat: [99, 475], certainly: [48, 475] },
    10: { notTrue: [151, 455], somewhat: [99, 455], certainly: [48, 455] },
    11: { notTrue: [151, 435], somewhat: [99, 435], certainly: [48, 435] },
    12: { notTrue: [151, 414], somewhat: [99, 414], certainly: [48, 414] },
    13: { notTrue: [151, 394], somewhat: [99, 394], certainly: [48, 394] },
    14: { notTrue: [151, 374], somewhat: [99, 374], certainly: [48, 374] },
    15: { notTrue: [151, 353], somewhat: [99, 353], certainly: [48, 353] },
    16: { notTrue: [151, 333], somewhat: [99, 333], certainly: [48, 333] },
    17: { notTrue: [151, 313], somewhat: [99, 313], certainly: [48, 313] },
    18: { notTrue: [151, 293], somewhat: [99, 293], certainly: [48, 293] },
    19: { notTrue: [151, 273], somewhat: [99, 273], certainly: [48, 273] },
    20: { notTrue: [151, 253], somewhat: [99, 253], certainly: [48, 253] },
    21: { notTrue: [151, 233], somewhat: [99, 233], certainly: [48, 233] },
    22: { notTrue: [151, 213], somewhat: [99, 213], certainly: [48, 213] },
    23: { notTrue: [151, 193], somewhat: [99, 193], certainly: [48, 193] },
    24: { notTrue: [151, 173], somewhat: [99, 173], certainly: [48, 173] },
    25: { notTrue: [151, 153], somewhat: [99, 153], certainly: [48, 153] }
  }

  // Draw checkmarks
  Object.entries(responses).forEach(([id, value]) => {
    const coords =
      // @ts-ignore
      checkboxCoords[id][
        value === 0 ? 'notTrue' : value === 1 ? 'somewhat' : 'certainly'
      ]

    page.drawText('x', {
      x: coords[0],
      y: coords[1],
      size: 20,
      font: arabicFont
    })
  })

  const pngBytes = await (await fetch(summaryPngDataUrl)).arrayBuffer()
  const pngImage = await pdfDoc.embedPng(pngBytes)
  const pngDims = pngImage.scale(0.7) // adjust scale

  const x = -150
  const y = -20 // adjust down/up until it sits where you want
  page.drawImage(pngImage, {
    x,
    y,
    width: pngDims.width,
    height: pngDims.height
  })

  // Save new PDF
  const pdfBytes = await pdfDoc.save()
  return pdfBytes
}
</file>

<file path="nuxt.config.ts">
// https://nuxt.com/docs/api/configuration/nuxt-config
export default defineNuxtConfig({
  modules: ['@nuxt/ui'],
  css: ['~/assets/css/main.css'],
  compatibilityDate: '2025-07-15',
  devtools: { enabled: true }
})
</file>

<file path="package.json">
{
  "name": "sdq",
  "type": "module",
  "private": true,
  "scripts": {
    "build": "nuxt build",
    "dev": "nuxt dev --host 0.0.0.0 --port 3001",
    "generate": "nuxt generate",
    "preview": "nuxt preview",
    "repomix": "repomix",
    "postinstall": "nuxt prepare"
  },
  "dependencies": {
    "@nuxt/hints": "1.0.0-alpha.2",
    "@nuxt/image": "^2.0.0",
    "@nuxt/ui": "^4.2.1",
    "@pdf-lib/fontkit": "^1.1.1",
    "nuxt": "^4.2.1",
    "pdf-lib": "^1.17.1",
    "repomix": "^1.9.2",
    "tailwindcss": "^4.1.17",
    "vue": "^3.5.25",
    "vue-router": "^4.6.3"
  }
}
</file>

<file path="public/robots.txt">
User-Agent: *
Disallow:
</file>

<file path="README.md">
# Nuxt Minimal Starter

Look at the [Nuxt documentation](https://nuxt.com/docs/getting-started/introduction) to learn more.

## Setup

Make sure to install dependencies:

```bash
# npm
npm install

# pnpm
pnpm install

# yarn
yarn install

# bun
bun install
```

## Development Server

Start the development server on `http://localhost:3000`:

```bash
# npm
npm run dev

# pnpm
pnpm dev

# yarn
yarn dev

# bun
bun run dev
```

## Production

Build the application for production:

```bash
# npm
npm run build

# pnpm
pnpm build

# yarn
yarn build

# bun
bun run build
```

Locally preview production build:

```bash
# npm
npm run preview

# pnpm
pnpm preview

# yarn
yarn preview

# bun
bun run preview
```

Check out the [deployment documentation](https://nuxt.com/docs/getting-started/deployment) for more information.
</file>

<file path="tsconfig.json">
{
  // https://nuxt.com/docs/guide/concepts/typescript
  "files": [],
  "references": [
    {
      "path": "./.nuxt/tsconfig.app.json"
    },
    {
      "path": "./.nuxt/tsconfig.server.json"
    },
    {
      "path": "./.nuxt/tsconfig.shared.json"
    },
    {
      "path": "./.nuxt/tsconfig.node.json"
    }
  ]
}
</file>

<file path=".gitignore">
# Nuxt dev/build outputs
.output
.data
.nuxt
.nitro
.cache

# Node dependencies
node_modules

# Logs
logs
*.log

# Misc
.DS_Store
.fleet
.idea

# Local env files
.env
.env.*
!.env.example
</file>

</files>
